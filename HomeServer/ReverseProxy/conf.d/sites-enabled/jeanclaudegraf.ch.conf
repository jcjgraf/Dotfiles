upstream homepage {
    server              homepage-wp:80;
}

server {
    listen              80;
    listen              [::]:80;
    server_name         www.jeanclaudegraf.ch jeanclaudegraf.ch *.jeanclaudegraf.ch;

    location / {
        rewrite ^ https://$host$request_uri? permanent;
    }

    location ~ /.well-known/acme-challenge {
        allow all;
        root /data/letsencrypt;
    }
}

#server {
#    listen              443 ssl http2;
#    listen              [::]:443 ssl http2;
#    server_name         jeanclaudegraf.ch;
#
#    # SSL
#    include             /etc/nginx/ssl.conf;
#    ssl_dhparam         /etc/ssl/certs/dhparam-2048.pem;
#    ssl_certificate     /etc/letsencrypt/live/jeanclaudegraf.ch/fullchain.pem;
#    ssl_certificate_key /etc/letsencrypt/live/jeanclaudegraf.ch/privkey.pem;
#
#    return 301 $scheme://www.jeanclaudegraf.ch$request_uri;
#}

server {
    listen              443 ssl http2;
    listen              [::]:443 ssl http2;
    server_name         www.jeanclaudegraf.ch;

    include             /etc/nginx/common.conf;

    # SSL
    include             /etc/nginx/ssl.conf;
    ssl_dhparam         /etc/ssl/certs/dhparam-2048.pem;
    ssl_certificate     /etc/letsencrypt/live/www.jeanclaudegraf.ch/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.jeanclaudegraf.ch/privkey.pem;

    #server_tokens off;
    #ssl_buffer_size 8k;
    #ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;
    #ssl_session_tickets off;

    #resolver 8.8.8.8 8.8.4.4;

    client_max_body_size 64M;

    location / {
        proxy_pass      http://homepage;
        #proxy_redirect  off;
        include         /etc/nginx/common_location.conf;
    }
}
